!function t(e,n,r){function a(i,s){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!s&&c)return c(i,!0);if(o)return o(i,!0);var l=new Error("Cannot find module '"+i+"'");throw l.code="MODULE_NOT_FOUND",l}var u=n[i]={exports:{}};e[i][0].call(u.exports,function(t){var n=e[i][1][t];return a(n?n:t)},u,u.exports,t,e,n,r)}return n[i].exports}for(var o="function"==typeof require&&require,i=0;i<r.length;i++)a(r[i]);return a}({1:[function(t,e,n){"use strict";t("./ready.js").then(function(){t("./results/slopes.js")(),t("./results/local-result-load.js")(),t("./results/sankey.js")()})},{"./ready.js":2,"./results/local-result-load.js":3,"./results/sankey.js":4,"./results/slopes.js":5}],2:[function(t,e,n){"use strict";e.exports=new Promise(function(t){function e(){r.removeEventListener(n,e),r.dispatchEvent(new CustomEvent("o."+n)),t()}var n="DOMContentLoaded",r=document,a="interactive"===r.readyState||"complete"===r.readyState;a?e():r.addEventListener(n,e)})},{}],3:[function(t,e,n){"use strict";function r(t){return t>0?"+"+t:t}var a=t("uk-political-parties"),o=t("d3");e.exports=function(){function t(t){var e=document.getElementById("seat-search-results-js"),o=t.elections.last.winner.party,i=t.elections.ge15.winner.party,s=function(t,e){return t?t===e?a.fullName(t)+" hold":a.fullName(t)+" gain from "+a.shortName(e):"No result yet"}(i,o),c=t.elections.ge15.results.sort(function(t,e){return e.votes-t.votes}),l=[],u={party:"other",votes:0,votes_pc:0};c.forEach(function(t,e){"other"!==t.party||t.winner?l.push(t):(u.votes+=t.votes,u.votes_pc+=t.votes_pc)}),u.votes_pc>0&&(u.votes_pc=Math.round(100*u.votes_pc)/100,l.push(u));var d="noresult";i&&(d="result");var f='<h2 class="article-body__subhead figure__title">'+t.name+'</h2><div class="seat-search-results__banner--'+d+" "+a.className(i)+'-block">'+s+"</div>";if(i&&2===t.elections.ge15.source.type){f+='<div class="seat-search-results__table">';for(var p=0;p<l.length;p++)f+='<div class="seat-search-results__row o-grid-row"><div data-o-grid-colspan="2">'+a.shortName(l[p].party)+'</div><div data-o-grid-colspan="7"><div class="seat-search-results__bar '+a.className(l[p].party)+'-block" style="width:'+l[p].votes_pc+'%"></div></div><div data-o-grid-colspan="3">'+l[p].votes_pc+"%</div></div>"}else f+='<div class="seat-search-results__waiting o-grid-row" data-o-grid-colspan="12">Awating full result.</div>';f+='<div class="figure__footer"><ul class="seat-search-results__detail-container">',void 0!==t.elections.ge15.winner&&(f+='<li class="seat-search-results__detail seat-search-results__elected"><b>Winner:</b> <span>'+t.elections.ge15.winner.person+" &ndash; "+a.fullName(t.elections.ge15.winner.party)+"</span></li>"),t.elections.ge15.turnout_pc&&(f+='<li class="seat-search-results__detail"><b>Turnout:</b> '+t.elections.ge15.turnout_pc+"% ("+r(t.elections.ge15.turnout_pc_change)+")</li>"),t.elections.ge15.winner.majority&&(f+='<li class="seat-search-results__detail"><b>Majority:</b> '+t.elections.ge15.winner.majority_pc+"%</li>"),f+="</ul></div>",f+='</div><div id="neighbouring-results-js"></div></div>',e.innerHTML=f;var h="/uk/2015/api/lookup/neighbours/"+t.id;fetch(h).then(n)["catch"](function(){})}function e(e){var n=o.select("#neighbouring-results-js");n.append("h4").attr("class","article-body__subhead figure__title").html("Nearby constituencies");var r=n.selectAll("div.neighbouring-results__row").data(e).enter().append("div").attr({"class":"o-grid-row neighbouring-results__row"});r.append("div").attr({"data-o-grid-colspan":"1"}).call(function(t){return t.append("div").attr({"class":function(t){return"neighbouring-results__old-party "+a.className(t.elections.last.winner.party)+"-block"}}).html("&nbsp;"),t.append("div").attr({"class":function(t){return"neighbouring-results__new-party "+a.className(t.elections.ge15.winner.party)+"-block"}}).html("&nbsp;"),t}),r.append("div").attr({"class":"neighbouring-result"}).html(function(t){return t.name}).on("click",function(e){t(e)})}function n(t){if(200!==t.status)throw t;return t.json().then(function(t){e(t)})}function i(t){var e;e="location"===t?"Couldn't get your location.":"postcode"===t?"There was a problem searching for a postcode.":t?t:"Couldn't find the seat";var n=document.getElementById("seat-search-results-js");n.innerHTML=e}function s(){document.getElementById("seat-search-results-js").innerHTML=""}function c(e){if(200!==e.status)throw e;return e.json().then(function(e){t(e.seat)})}function l(t){return function(e){return e instanceof Error||500===e.status?void i(t):e.json().then(function(t){i(t.error)})["catch"](function(){i(t)})}}function u(){f.classList.add("loading")}function d(){f.classList.remove("loading")}var f=document.querySelector(".postcode-lookup"),p=document.getElementById("use-mylocation-js");"geolocation"in navigator?p.addEventListener("click",function(t){function e(t){return d(),l("location")(t)}function n(t){document.getElementById("seat-search-js").elements.postcode.value="";var n=[t.coords.longitude,t.coords.latitude].join(","),r="/uk/2015/api/lookup/point/"+n;fetch(r).then(c).then(d)["catch"](e)}u(),navigator.geolocation.getCurrentPosition(n,e)}):p.style.display="none",document.getElementById("seat-search-js").addEventListener("submit",function(t){function e(t){return d(),l("postcode")(t)}t.preventDefault(),u();var n=t.target.elements.postcode,r=n.value.trim();if(!r)return n.value="",void s();var a="/uk/2015/api/lookup/postcode/"+r;fetch(a).then(c).then(d)["catch"](e)})}},{d3:"d3","uk-political-parties":"uk-political-parties"}],4:[function(t,e,n){"use strict";function r(t,e){t.select("svg").remove();var n=t.node().getBoundingClientRect(),r=540,c=n.width,p={top:30,left:0,bottom:40,right:0},b=r-(p.top+p.bottom),k=c-(p.left+p.right),x=20,_=30,w=y.sankey().size([k,b]).nodeWidth(_).nodePadding(x).nodes(e.nodes).links(e.links).layout(32),E=w.link(),j=t.append("svg").attr({width:c,height:r,"class":"sankey"}),L=j.append("defs").selectAll("linearGradient").data(e.links).enter().append("linearGradient").attr({id:d,x1:"0%",x2:"100%",y1:"0%",y2:"0%"});L.append("stop").attr({offset:"0%"}).style("stop-color",function(t){return g(t.source.name)}).style("stop-opacity",1),L.append("stop").attr({offset:"100%"}).style("stop-color",function(t){return g(t.target.name)}).style("stop-opacity",1),j.selectAll("text.axis-label").data(["Last election","Now"]).enter().append("text").attr({"class":"axis-label","text-anchor":function(t,e){return 0===e?"start":"end"},transform:function(t,e){var n=(c-p.right)*e,r=p.top-8;return"translate("+n+","+r+")"}}).text(function(t){return t}),j=j.append("g").attr("transform","translate("+p.left+","+p.top+")");var A=j.append("g").selectAll(".link").data(e.links).enter().append("g").attr("class","link-container");A.append("path").attr({"class":function(t){return"link "+f(t)},"data-from":function(t){return h(t.source.name)},"data-to":function(t){return h(t.target.name)},d:E}).style("stroke-width",function(t){return Math.max(1,t.dy)}),A.append("text").attr({x:_+6,y:function(t){return t.source.y+t.sy+t.dy/2},"data-from":function(t){return h(t.source.name)},"data-to":function(t){return h(t.target.name)},"class":"source link-label inactive",dy:".35em"}).text(function(t){return v(t.source.name)+": "+t.value}),A.append("text").attr({x:k-(_+6),y:function(t){return t.target.y+t.ty+t.dy/2},"data-from":function(t){return m.className(t.source.name)},"data-to":function(t){return m.className(t.target.name)},dy:".35em","class":"target link-label inactive","text-anchor":"end"}).text(function(t){return v(t.target.name)+": "+t.value});var N=j.append("g").selectAll(".node").data(e.nodes).enter().append("g").attr("class","node").attr("transform",function(t){return"translate("+t.x+","+t.y+")"});N.append("rect").attr("height",function(t){return Math.max(1,t.dy)}).attr("width",w.nodeWidth()).attr("class",function(t){return"node "+h(t.name)+"-area"}).append("title").text(function(t){return t.name+" "+t.value}),N.append("rect").attr("height",function(t){return t.dy+x}).attr("y",function(t){return-x/2}).attr("x",function(t){return t.x>k/2?-k/2+w.nodeWidth():0}).attr("width",k/2).attr("class","selection-rect").append("title").text(function(t){return t.name+" "+t.value}),N.append("text").attr({x:-6,y:function(t){return t.dy/2},dy:".35em","text-anchor":"end",transform:null,"class":"target node-label","data-party":function(t){return h(t.name)}}).text(function(t){return v(t.name)+": "+t.value}).filter(function(t){return t.x<c/2}).attr({x:6+w.nodeWidth(),"class":"source node-label","text-anchor":"start"}),y.selectAll(".node").on("click",function(t){u();var e=a(t);l(e.list.join(", ")),s(e.direction,e.party)}).on("mouseover",function(t){o(),i(a(t).list.join(", "))}).on("mouseout",function(){o()}),y.selectAll("path").on("click",function(t){u(),l("."+f(t)),s("both",t.source.name,t.target.name)})}function a(t){var e=[],n="to",r="";return t.sourceLinks.forEach(function(t){e.push("."+f(t)),n="from",r=t.source.name}),t.targetLinks.forEach(function(t){e.push("."+f(t)),r=t.target.name}),{list:e,direction:n,party:r}}function o(){y.selectAll("path.link").classed("hint",!1)}function i(t){y.selectAll(t).classed("hint",!0)}function s(t,e,n){return y.selectAll("text.node-label").classed("inactive",!0),y.selectAll("text.link-label").classed("inactive",!0),t&&e?void("both"===t?y.selectAll('.link-label[data-to="'+h(n)+'"][data-from="'+h(e)+'"]').classed("inactive",!1):"to"===t?(y.selectAll(".source.link-label[data-"+t+'="'+h(e)+'"]').classed("inactive",!1),y.selectAll('.target.node-label[data-party="'+h(e)+'"]').classed("inactive",!1)):(y.selectAll(".target.link-label[data-"+t+'="'+h(e)+'"]').classed("inactive",!1),y.selectAll('.source.node-label[data-party="'+h(e)+'"]').classed("inactive",!1))):void y.selectAll("text.node-label").classed("inactive",!1)}function c(t){return t.source.name===t.target.name?g(t.source.name):"url(#"+d(t)+")"}function l(t){y.selectAll(t).classed("selected",!0).style("stroke",c).style("stroke-opacity",1).call(function(t){return p(t.data()),this})}function u(){y.selectAll("rect").classed("selected",!1),y.selectAll("path").classed("selected",!1).style("stroke",null).style("stroke-opacity",null),y.selectAll("text.line-label").classed("inactive",!0),y.selectAll(".node text").classed("inactive",!1)}function d(t){return h(t.source.name)+"--"+h(t.target.name)+"-gradient"}function f(t){return h(t.source.name)+"-to-"+h(t.target.name)}function p(t){function e(t,e){var n="seats";return 1===t.value&&(n="seat"),t.source.name===t.target.name?t.source.name+" retain <b>"+t.value+"</b> "+n:e?t.source.name+" lose <b>"+t.value+"</b> "+n+" to "+t.target.name:t.target.name+" gain <b>"+t.value+"</b> "+n+" from "+t.source.name}var n=t.sort(function(t,e){return e.value-t.value}),r=y.selectAll(".info-pane").selectAll("div").data(n);r.exit().remove(),r.enter().append("div");var a=!1;t.length>1&&(a=t[0].target!==t[1].target),r.html(function(t){return e(t,a)})}function h(t){return m.className(t)?m.className(t):"undeclared"}function v(t){return m.shortName(t)?m.shortName(t):"not declared"}function g(t){return m.colour(t)?m.colour(t):"#74736c"}var y=t("d3"),m=t("uk-political-parties");y.sankey=t("../sankey/d3plugin.js");var b=t("lodash/function/debounce");e.exports=function(){if(sankeyData){y.select(".results-sankey").call(r,sankeyData);var t=b(function(t){y.select(".results-sankey").call(r,sankeyData)},50);window.addEventListener("resize",t,!1)}}},{"../sankey/d3plugin.js":6,d3:"d3","lodash/function/debounce":8,"uk-political-parties":"uk-political-parties"}],5:[function(t,e,n){"use strict";function r(t,e,n,r){var a=c.scale.linear().domain(r).range([e.height-(n.top+n.bottom),0]);return t.attr({width:e.width}),t.selectAll("g.slope").each(function(t){var r=c.select(this);r.select("line").attr({x1:0,y1:a(t.start),x2:e.width-n.right,y2:a(t.end)}),r.select("text").attr("transform","translate("+(e.width-n.right+5)+","+(a(t.end)+5)+")").classed("slope-graphic__slope-text",e.width>300).classed("slope-graphic__slope-text-small",e.width<=300),r.select(".slope-graphic__slope-point-start").attr({cx:0,cy:a(t.start)}),r.select(".slope-graphic__slope-point-end").attr({cx:e.width-n.right,cy:a(t.end)})}),t}function a(t){var e=t.selectAll("text");return e.each(function(t,n){if(n>0){var r=s(this,e[0][n-1]);if(r>0){var a=o(this);c.select(this).attr("transform","translate("+a.x+","+(a.y+r)+")")}}}),t}function o(t){var e=i(c.select(t).attr("transform")).translate;return{x:+e[0],y:+e[1]}}function i(t){var e={};t=t.match(/(\w+\((\-?\d+\.?\d*e?\-?\d*,?)+\))+/g);for(var n in t)if(t.hasOwnProperty(n)){var r=t[n].match(/[\w\.\-]+/g);e[r.shift()]=r}return e}function s(t,e){var n=t.getBoundingClientRect(),r=e.getBoundingClientRect();return r.bottom-n.top}var c=t("d3"),l=t("lodash/function/debounce");e.exports=function(){c.selectAll(".figure__body.slope-graphic").call(function(t){var e=t.select("svg");if(e.dataset){var n=e.node().dataset,o={top:+n.margintop,left:+n.marginleft,bottom:+n.marginbottom,right:+n.marginright},i=[0,n.domain],s=[];e.selectAll("g.slope").each(function(){var t=this.dataset;s.push({start:+t.start,end:+t.end,party:t.party,label:t.label})}).data(s),e.call(r,t.node().getBoundingClientRect(),o,i).call(a);var c=l(function(n){e.call(r,t.node().getBoundingClientRect(),o,i).call(a)},50);return window.addEventListener("resize",c,!1),t}})}},{d3:"d3","lodash/function/debounce":8}],6:[function(t,e,n){"use strict";var r=t("d3");e.exports=function(){function t(){h.forEach(function(t){t.sourceLinks=[],t.targetLinks=[]}),v.forEach(function(t){var e=t.source,n=t.target;"number"==typeof e&&(e=t.source=h[t.source]),"number"==typeof n&&(n=t.target=h[t.target]),e.sourceLinks.push(t),n.targetLinks.push(t)})}function e(){h.forEach(function(t){t.value=Math.max(r.sum(t.sourceLinks,l),r.sum(t.targetLinks,l))})}function n(){for(var t,e=h,n=0;e.length;)t=[],e.forEach(function(e){e.x=n,e.dx=d,e.sourceLinks.forEach(function(e){t.indexOf(e.target)<0&&t.push(e.target)})}),e=t,++n;a(n),o((p[0]-d)/(n-1))}function a(t){h.forEach(function(e){e.sourceLinks.length||(e.x=t-1)})}function o(t){h.forEach(function(e){e.x*=t})}function i(t){function e(){var t=r.min(s,function(t){return(p[1]-(t.length-1)*f)/r.sum(t,l)});s.forEach(function(e){e.forEach(function(e,n){e.y=n,e.dy=e.value*t})}),v.forEach(function(e){e.dy=e.value*t})}function n(t){function e(t){return c(t.source)*t.value}s.forEach(function(n,a){n.forEach(function(n){if(n.targetLinks.length){var a=r.sum(n.targetLinks,e)/r.sum(n.targetLinks,l);n.y+=(a-c(n))*t}})})}function a(t){function e(t){return c(t.target)*t.value}s.slice().reverse().forEach(function(n){n.forEach(function(n){if(n.sourceLinks.length){var a=r.sum(n.sourceLinks,e)/r.sum(n.sourceLinks,l);n.y+=(a-c(n))*t}})})}function o(){s.forEach(function(t){var e,n,r,a=0,o=t.length;for(t.sort(i),r=0;o>r;++r)e=t[r],n=a-e.y,n>0&&(e.y+=n),a=e.y+e.dy+f;if(n=a-f-p[1],n>0)for(a=e.y-=n,r=o-2;r>=0;--r)e=t[r],n=e.y+e.dy+f-a,n>0&&(e.y-=n),a=e.y})}function i(t,e){return t.y-e.y}var s=r.nest().key(function(t){return t.x}).sortKeys(r.ascending).entries(h).map(function(t){return t.values});e(),o();for(var u=1;t>0;--t)a(u*=.99),o(),n(u),o()}function s(){function t(t,e){return t.source.y-e.source.y}function e(t,e){return t.target.y-e.target.y}h.forEach(function(n){n.sourceLinks.sort(e),n.targetLinks.sort(t)}),h.forEach(function(t){var e=0,n=0;t.sourceLinks.forEach(function(t){t.sy=e,e+=t.dy}),t.targetLinks.forEach(function(t){t.ty=n,n+=t.dy})})}function c(t){return t.y+t.dy/2}function l(t){return t.value}var u={},d=24,f=8,p=[1,1],h=[],v=[];return u.nodeWidth=function(t){return arguments.length?(d=+t,u):d},u.nodePadding=function(t){return arguments.length?(f=+t,u):f},u.nodes=function(t){return arguments.length?(h=t,u):h},u.links=function(t){return arguments.length?(v=t,u):v},u.size=function(t){return arguments.length?(p=t,u):p},u.layout=function(r){return t(),e(),n(),i(r),s(),u},u.relayout=function(){return s(),u},u.link=function(){function t(t){var n=t.source.x+t.source.dx,a=t.target.x,o=r.interpolateNumber(n,a),i=o(e),s=o(1-e),c=t.source.y+t.sy+t.dy/2,l=t.target.y+t.ty+t.dy/2;return"M"+n+","+c+"C"+i+","+c+" "+s+","+l+" "+a+","+l}var e=.5;return t.curvature=function(n){return arguments.length?(e=+n,t):e},t},u}},{d3:"d3"}],7:[function(t,e,n){var r=t("../internal/getNative"),a=r(Date,"now"),o=a||function(){return(new Date).getTime()};e.exports=o},{"../internal/getNative":9}],8:[function(t,e,n){function r(t,e,n){function r(){y&&clearTimeout(y),p&&clearTimeout(p),b=0,p=y=m=void 0}function c(e,n){n&&clearTimeout(n),p=y=m=void 0,e&&(b=o(),h=t.apply(g,f),y||p||(f=g=void 0))}function l(){var t=e-(o()-v);0>=t||t>e?c(m,p):y=setTimeout(l,t)}function u(){c(x,y)}function d(){if(f=arguments,v=o(),g=this,m=x&&(y||!_),k===!1)var n=_&&!y;else{p||_||(b=v);var r=k-(v-b),a=0>=r||r>k;a?(p&&(p=clearTimeout(p)),b=v,h=t.apply(g,f)):p||(p=setTimeout(u,r))}return a&&y?y=clearTimeout(y):y||e===k||(y=setTimeout(l,e)),n&&(a=!0,h=t.apply(g,f)),!a||y||p||(f=g=void 0),h}var f,p,h,v,g,y,m,b=0,k=!1,x=!0;if("function"!=typeof t)throw new TypeError(i);if(e=0>e?0:+e||0,n===!0){var _=!0;x=!1}else a(n)&&(_=!!n.leading,k="maxWait"in n&&s(+n.maxWait||0,e),x="trailing"in n?!!n.trailing:x);return d.cancel=r,d}var a=t("../lang/isObject"),o=t("../date/now"),i="Expected a function",s=Math.max;e.exports=r},{"../date/now":7,"../lang/isObject":13}],9:[function(t,e,n){function r(t,e){var n=null==t?void 0:t[e];return a(n)?n:void 0}var a=t("../lang/isNative");e.exports=r},{"../lang/isNative":12}],10:[function(t,e,n){function r(t){return!!t&&"object"==typeof t}e.exports=r},{}],11:[function(t,e,n){function r(t){return a(t)&&s.call(t)==o}var a=t("./isObject"),o="[object Function]",i=Object.prototype,s=i.toString;e.exports=r},{"./isObject":13}],12:[function(t,e,n){function r(t){return null==t?!1:a(t)?u.test(c.call(t)):o(t)&&i.test(t)}var a=t("./isFunction"),o=t("../internal/isObjectLike"),i=/^\[object .+?Constructor\]$/,s=Object.prototype,c=Function.prototype.toString,l=s.hasOwnProperty,u=RegExp("^"+c.call(l).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");e.exports=r},{"../internal/isObjectLike":10,"./isFunction":11}],13:[function(t,e,n){function r(t){var e=typeof t;return!!t&&("object"==e||"function"==e)}e.exports=r},{}]},{},[1]);
